{% extends 'base.html' %}

{% block title %}
  Listagem de Modelos de Vestígio
{% endblock %}
{% block maintitle %}
  Listagem de Modelos de Vestígio
{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item">
    <a href="#">Modelos de Vestígio</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">Listagem</li>
{% endblock %}

{% block content %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert mt-5 {% if message.tags %}
           alert-{{ message.tags }}
        {% else %}
           alert-info
        {% endif %}"
        role="alert">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <!-- Modal -->
  <div class="modal fade" id="modalTipo" tabindex="-1" aria-labelledby="modalTipoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="modalTipoLabel">Seleção de Tipo de Vestigio</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="visibilidadeModelo" class="form-label">Tipo de Vestigio*</label>
            <select name="type" id="visibilidadeModelo" required class="form-select" aria-label="Default select example">
              <option selected value="">Selecione uma opção...</option>
              <option value="1">Armamento</option>
              <option value="2">Arquivo Digital</option>
              <option value="3">Dispositivo Tecnologico</option>
              <option value="4">Documento</option>
              <option value="5">Impressão Papiloscopica</option>
              <option value="6">Material</option>
              <option value="7">Objeto</option>
              <option value="8">Veiculo</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="btnSalvarModelo" class="btn btn-primary"><i class="fas fa-save"></i> Criar Modelo</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-backspace"></i> Voltar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="card py-3 px-2 bg-white">
    <div class="p-2">
      <h5>Listagem</h5>
    </div>
    <div class="card-body">
      <div class="text-end">
        <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#modalTipo"><i class="fas fa-plus"></i> Cadastrar</button>
      </div>

      <table id="listagem" class="table table-striped table-bordered" style="width:100%">
        <thead>
          <tr>
            <th>Descricao</th>
            <th>Vestígio</th>
            <th>Usuário</th>
            <th>Tipo</th>
            <th>Inclusão</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for modelo in modelos %}
            <tr>
              <td>{{ modelo.name }}</td>
              <td>{{ modelo.get_type_vestigio_display }}</td>
              <td>{{ modelo.user_inclusion.first_name }} {{ modelo.user_inclusion.last_name }}</td>
              <td>
                {% if modelo.type == 1 %}
                  <span class="badge text-bg-success" style="font-size: 0.9rem;">{{ modelo.get_type_display }}</span>
                {% else %}
                  <span class="badge text-bg-danger" style="font-size: 0.9rem;">{{ modelo.get_type_display }}</span>
                {% endif %}
              </td>
              <td>{{ modelo.date_inclusion|date:'d/m/Y H:i' }}</td>
              <td class="is-narrow">
                <div class="text-end">
                  <a href="/modelo/vestigio/visualizar/{{ modelo.id }}"><button class="btn btn-success btn-sm"><i class="fas fa-eye"></i></button></a>
                  <a href="/modelo/vestigio/editar/{{ modelo.id }}"><button class="btn btn-primary btn-sm"><i class="fas fa-edit"></i></button></a>
                  <a href="/modelo/vestigio/deletar/{{ modelo.id }}"><button class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></button></a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
  <script>
    $(document).ready(function () {
      $('#listagem').DataTable({
        // Opções de personalização
        paging: true, // Habilita paginação
        searching: false, // Habilita barra de pesquisa
        info: true, // Exibe informações como "Mostrando X de Y"
        lengthChange: true, // Permite alterar o número de linhas exibidas
        pageLength: 10, // Define o número padrão de linhas por página
        language: {
          url: 'https://cdn.datatables.net/plug-ins/1.13.5/i18n/pt-BR.json'
        }
      })
    })

    $(document).ready(function() {
        $("#btnSalvarModelo").on("click", function() {
            let selectedValue = $("#visibilidadeModelo").val();
    
            if (!selectedValue) {
                alert("Por favor, selecione um tipo de vestígio antes de continuar.");
                return;
            }
    
            // Redireciona para a URL concatenada
            window.location.href = `/modelo/vestigio/criar/${selectedValue}`;
        });
    });
    
  </script>
{% endblock %}
