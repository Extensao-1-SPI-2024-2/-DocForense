{% extends "base.html" %}

{% block title %}Listagem de Modelos Laudo{% endblock %}
{% block maintitle %}Listagem de Modelos Laudo{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="#">Modelos de Laudo</a></li>
  <li class="breadcrumb-item active" aria-current="page">Listagem</li>
{% endblock %}

{% block content %}
{% if messages %}
{% for message in messages %}
  <div class="alert mt-5 {% if message.tags %} alert-{{ message.tags }}{% else %} alert-info {% endif %}"
    role="alert">{{ message }}</div>
{% endfor %}
{% endif %}
<!-- Modal de Confirmação -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="confirmDeleteModalLabel"><strong>Você está prestes a excluir um registro. </strong></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <p>Você deseja mesmo realizar esta ação?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Confirmar Exclusão</a>
            </div>
        </div>
    </div>
</div>

  <div class="card py-3 px-2 bg-white">
    <div class="p-2">
      <h5>Listagem</h5>
    </div>
    <div class="card-body">
      <div class="text-end">
        <a href="/modelo/laudo/criar"><button class="btn btn-primary"><i class="fas fa-plus"></i> Cadastrar</button></a>
      </div>

      <table id="listagem" class="table table-striped table-bordered" style="width:100%">
        <thead>
          <tr>
            <th>Descricao</th>
            <th>Usuário</th>
            <th>Tipo</th>
            <th>Inclusão</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for modelo in modelos %}
            <tr>
              <td>{{ modelo.name }}</td>
              <td>{{ modelo.user_inclusion.first_name }} {{ modelo.user_inclusion.last_name }}</td>
              <td>
                {% if modelo.type == 1 %}
                    <span class="badge text-bg-success" style="font-size: 0.9rem;">{{ modelo.get_type_display }}</span>
                {% else %}
                    <span class="badge text-bg-danger" style="font-size: 0.9rem;">{{ modelo.get_type_display }}</span>
                {% endif %}
              </td>
              <td>{{ modelo.date_inclusion|date:'d/m/Y H:i' }}</td>
              <td class="is-narrow">
                <div class="text-end">
                    <a href="/modelo/laudo/visualizar/{{ modelo.id }}"><button class="btn btn-success btn-sm"><i class="fas fa-eye"></i></button></a>
                    <a href="/modelo/laudo/editar/{{ modelo.id }}"><button class="btn btn-primary btn-sm"><i class="fas fa-edit"></i></button></a>
                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-url="/modelo/laudo/deletar/{{ modelo.id }}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
  <script>
    $(document).ready(function () {
      $('#listagem').DataTable({
        // Opções de personalização
        paging: true, // Habilita paginação
        searching: false, // Habilita barra de pesquisa
        info: true, // Exibe informações como "Mostrando X de Y"
        lengthChange: true, // Permite alterar o número de linhas exibidas
        pageLength: 10, // Define o número padrão de linhas por página
        language: {
          url: "https://cdn.datatables.net/plug-ins/1.13.5/i18n/pt-BR.json"
        }
      })
    })

    document.addEventListener("DOMContentLoaded", function() {
        var confirmDeleteModal = document.getElementById('confirmDeleteModal');
        var confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        confirmDeleteModal.addEventListener('show.bs.modal', function(event) {
            var button = event.relatedTarget; // Botão que acionou o modal
            var deleteUrl = button.getAttribute('data-url'); // Pega o link do botão

            confirmDeleteBtn.setAttribute('href', deleteUrl); // Atualiza o botão de exclusão
        });
    });
  </script>
{% endblock %}
